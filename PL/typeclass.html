<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Type Classes &#8212; Site-32  documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Paper Reading: Lightweight-Higher-Kinded-Polymorphism" href="paper-reading-LHKP.html" />
    <link rel="prev" title="Higher Kinded Types" href="HKT.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../guide.html">
          Site-32</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">PL</a></li>
                <li><a href="../Compiler/index.html">Compiler</a></li>
                <li><a href="../Innovation/index.html">Innovation</a></li>
                <li><a href="../Design/index.html">Design</a></li>
                <li><a href="../DSL/index.html">DSL</a></li>
                <li><a href="../Fiction/index.html">Fiction</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../guide.html">Site-32 <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Site-32 Index Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Compiler/index.html">Compiler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/RBNF.html">RBNF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/RBNFRBNF.html">RBNFRBNF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/Parserc.html">Parser Combinator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/完美的编译前端.html">完美的编译前端</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/非文法变换的左递归处理.html">非文法变换的左递归处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/LLAST.html">LLAST</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Design/index.html">Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Design/组合的道理.html">组合的道理</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../DSL/index.html">DSL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../DSL/write-your-a-query-language-with-MLStyle.html">Write You A Query Language</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Fiction/index.html">Fiction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Programming Language</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="HKT.html">Higher Kinded Types</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Type Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="paper-reading-LHKP.html">Paper Reading: Lightweight-Higher-Kinded-Polymorphism</a></li>
<li class="toctree-l2"><a class="reference internal" href="HKT-typeclass-FSharp.html">Compelling Higher Kinded Types and Type Classes in F#</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Innovation/index.html">Innovation</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Sub-sections <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Type Classes</a><ul>
<li><a class="reference internal" href="#about-abstractions">About Abstractions</a></li>
<li><a class="reference internal" href="#about-separation-of-type-definitions-and-data-manipulations">About Separation of Type Definitions and Data Manipulations</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/PL/typeclass.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
  <li>
    <a href="HKT.html" title="Previous Chapter: Higher Kinded Types"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Higher Kinded Types</span>
    </a>
  </li>
  <li>
    <a href="paper-reading-LHKP.html" title="Next Chapter: Paper Reading: Lightweight-Higher-Kinded-Polymorphism"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Paper Reading... &raquo;</span>
    </a>
  </li>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="type-classes">
<h1>Type Classes<a class="headerlink" href="#type-classes" title="Permalink to this headline">¶</a></h1>
<p>Distinct from the traditional interfaces from so-called OOP, there is a solution to
make abstractions on types(including higher kinded types, the same below) and separate assigning features to types from the type definitions.</p>
<div class="section" id="about-abstractions">
<h2>About Abstractions<a class="headerlink" href="#about-abstractions" title="Permalink to this headline">¶</a></h2>
<p>One of the goal of abstractions is to make better reuse of codes, which could be acheived through polymorphisms.</p>
<p>Another goal of abstractions is to make programs safer, which could be acheived through static checking.</p>
<p>To meet these expectations,  the <strong>Type Class</strong> then came into being.</p>
<p>A well-known example of polymorphisms with type classes is <code class="code docutils literal notranslate"><span class="pre">Functor</span></code>, the polymorphic function <code class="code docutils literal notranslate"><span class="pre">map</span></code> could be applied
on <code class="code docutils literal notranslate"><span class="pre">Array</span></code>, <code class="code docutils literal notranslate"><span class="pre">List</span></code>, <code class="code docutils literal notranslate"><span class="pre">Maybe/Option</span></code>, etc.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="nb">map</span> <span class="p">:</span> <span class="n">forall</span> <span class="p">{</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Functor</span> <span class="n">f</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="n">b</span>
<span class="n">val</span> <span class="n">lst</span> <span class="p">:</span> <span class="n">List</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span>
<span class="n">val</span> <span class="n">arr</span> <span class="p">:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span>
<span class="n">val</span> <span class="n">m</span>   <span class="p">:</span> <span class="n">Maybe</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span>
<span class="n">let</span> <span class="n">f</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">let</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">map</span> <span class="n">f</span> <span class="n">lst</span>
<span class="n">let</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">map</span> <span class="n">f</span> <span class="n">arr</span>
<span class="n">let</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">map</span> <span class="n">f</span> <span class="n">m</span>
</pre></div>
</div>
<p>In above codes, <code class="code docutils literal notranslate"><span class="pre">List,</span> <span class="pre">Array,</span> <span class="pre">Maybe</span></code> are all <code class="code docutils literal notranslate"><span class="pre">Functor</span></code> s.</p>
<p>The <strong>Functor</strong> is not a type or type constructor. In my point of view, a type class <span class="math notranslate nohighlight">\(A\)</span> could be taken
as a set of attributes <span class="math notranslate nohighlight">\(\{A_1, A_2, \cdots \}\)</span> that could be used to describe types, and if we say type <span class="math notranslate nohighlight">\(a\)</span> is an instance of type class <span class="math notranslate nohighlight">\(A\)</span>,
it’s the same to say that <span class="math notranslate nohighlight">\(a\)</span> has a set of attributes <span class="math notranslate nohighlight">\(\{A_1, A_2, \cdots \}\)</span>. These attributes can be leveraged for so-called instance resolution,
which specializes the implementation/instance of a polymorphic function on its callsite.</p>
<p>Given a custom implementation of <code class="code docutils literal notranslate"><span class="pre">Functor</span></code> and its instance for <code class="code docutils literal notranslate"><span class="pre">List</span></code>,</p>
<div class="highlight-Haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">type</span> <span class="kt">List</span> <span class="ow">=</span> <span class="kt">[]</span> <span class="o">#</span> <span class="n">avoid</span> <span class="n">confusing</span> <span class="n">stuffs</span> <span class="n">for</span> <span class="n">newbies</span><span class="o">.</span>

<span class="kr">class</span> <span class="kt">Functor</span> <span class="n">f</span> <span class="kr">where</span>
    <span class="n">map</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">f</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">f</span> <span class="n">b</span>

<span class="kr">instance</span> <span class="kt">Functor</span> <span class="p">(</span><span class="kt">List</span><span class="p">)</span>
    <span class="n">map</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="n">f</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="n">b</span>
    <span class="n">map</span> <span class="n">f</span> <span class="ow">=</span> <span class="nf">\</span><span class="kr">case</span>
            <span class="kt">[]</span>   <span class="ow">-&gt;</span> <span class="kt">[]</span>
            <span class="n">x</span><span class="kt">:</span><span class="n">xs</span> <span class="ow">-&gt;</span> <span class="n">f</span> <span class="n">x</span> <span class="kt">:</span> <span class="n">map</span> <span class="n">f</span> <span class="n">xs</span>
</pre></div>
</div>
<p>Let’s see how to perform instance resolution on the callsites of <code class="code docutils literal notranslate"><span class="pre">map</span></code> .</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>map (+1) [1, 2, 3]

1. map :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
2. [1, 2, 3] :: Num a =&gt; List a
3. (+)       :: Num a =&gt; a -&gt; a -&gt; a
4. 1         :: Num a =&gt; a

5. for (3), (4),
    (+1)     :: Num a =&gt; a -&gt; a

6. for (1), (2)
    f = List,
    now look up the instance (Functor List),
    find out the corresponding map function.

    map :: (a -&gt; b) -&gt; f a -&gt; f b,
    where f = List, a = Num a =&gt; a

7. for (6), (5),

    a -&gt; b ~ Num a =&gt; a -&gt; a
    b :: Num a =&gt; a
    (+1) :: Num a =&gt; a -&gt; a

    p.s: `~` means `unify`

8. as a result,

    map (+1) [1, 2, 3] :: Num a =&gt; List a
</pre></div>
</div>
<p>If we make the instance <code class="code docutils literal notranslate"><span class="pre">Functor</span> <span class="pre">A</span></code>, then we can use the polymorphic <code class="code docutils literal notranslate"><span class="pre">map</span></code> function
on type <code class="code docutils literal notranslate"><span class="pre">A</span></code>.</p>
<p>Something deserved to be note here is, although the traditional interfaces from OOP can provide polymorphisms,
it’s much weaker when it comes to static checking. Type classes reach polymorphisms without casting objects,
while if you want to use methods of some OOP interface, an unnecessary cast is always required.</p>
<p>For type classes could be leveraged to implement full-featured interfaces and the real(not the emulated) type classes can be faster than
interfaces(type classes avoid some redundant runtime costs), we can safely make the conclusion that type classes are superior to OOP interfaces.</p>
</div>
<div class="section" id="about-separation-of-type-definitions-and-data-manipulations">
<h2>About Separation of Type Definitions and Data Manipulations<a class="headerlink" href="#about-separation-of-type-definitions-and-data-manipulations" title="Permalink to this headline">¶</a></h2>
<p>OOP interfaces strongly couple the definitions with the valid interoperations for a type(for you have to point out which interfaces to be inherited), while
type classes provide the freedom upon this aspect.</p>
<p>For instance, a <code class="code docutils literal notranslate"><span class="pre">show</span></code> method is aimed at representing the objects of some type that implements type class <code class="code docutils literal notranslate"><span class="pre">Show</span></code>
with strings.</p>
<div class="highlight-Haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">data</span> <span class="kt">S</span> <span class="ow">=</span> <span class="kt">S</span>
<span class="kr">instance</span> <span class="kt">Show</span> <span class="kt">S</span> <span class="kr">where</span>
    <span class="n">show</span> <span class="kt">S</span> <span class="ow">=</span> <span class="s">&quot;oh, it&#39;s a S, the unique S!&quot;</span>
</pre></div>
</div>
<p>In traditional OOP, we have to define <code class="code docutils literal notranslate"><span class="pre">toString/ToString/__str__</span></code> methods exactly when defining the types, while languages with
type classes, like Rust and Haskell, would allow you to define it somewhere more proper. Something that is super advanced is,
you can make <code class="code docutils literal notranslate"><span class="pre">show</span></code> method qualified in current workload, and allow other implementations of <code class="code docutils literal notranslate"><span class="pre">show</span></code> outside the qualified scope.</p>
<p>This extremely enhanced the extensibility and enabled thorough uncoupling without any mental burden.</p>
<p>To illustrate the advantages, let’s think about F#.</p>
<p>1. F# doesn’t support statically resolved type parameters with type extensions, as a consequence, although it’s feasible for F# to implement ad-hoc polymorphisms,
but in terms of some built-in datatypes and primitive types like <code class="code docutils literal notranslate"><span class="pre">int,</span> <span class="pre">List,</span> <span class="pre">Array</span></code>, etc., it’s definitely impossible. A wrapper is always required,
and severe performance issues could be caused.</p>
<p>2. Let’s focus on the <code class="code docutils literal notranslate"><span class="pre">show</span></code> again. The common method <code class="code docutils literal notranslate"><span class="pre">sprintf</span></code> is already defined and works with some existed protocols which should been ensured when definining
the your data types. The way to organize your codes is then fixed, of course the way to <em>sprintf</em> a datatype is then fixed, too.</p>
<div class="highlight-FSharp notranslate"><div class="highlight"><pre><span></span><span class="o">[&lt;</span><span class="n">StructuredFormatDisplay</span><span class="o">(</span><span class="s">&quot;{str}&quot;</span><span class="o">)&gt;]</span> <span class="c1">// This must be given here to make custom format method.</span>
<span class="k">type</span> <span class="nc">MyData</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, thautwarm.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>